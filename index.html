<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- 시스템 주입 스크립트 (기존 로직 유지) -->
    <script class="injected-ffc2e83d85">
        /* 환경 보전을 위한 시스템 폴리필 및 이미지 처리 로직 (생략/유지) */
        (function(){"use strict"; /* ...기존 주입 코드... */ }).call(this);
    </script>
    
    <script class="injected-ffc2e83d85">
        const IMG_GEN_REPLACE_MAP = {
            "1990s korean lottery broadcast announcer on old tv bright colors distorted analog video&aspect=4:3": "./korean-lottery.jpg",
            "creepy white ghost hands pressing against glass from inside horror glitch analog&aspect=4:3": "./ghost-hand.jpg",
            "korean lotto 645 ticket paper crumpled realistic with handwritten numbers&aspect=3:4": "./lottery-paper.jpg",
            "distorted terrifying pale face pressed against crt tv screen horror&aspect=4:3": "./ghost-face.jpg",
            "analog static glitch art with distorted screaming silhouette&aspect=4:3": "./noise-maker.jpg",
            "government warning psa screen about gambling addiction korean text boring blue background&aspect=4:3": "./another-broadcast.jpg",
        };
        const MAY_HAVE_BACKGROUND_IMAGE = true;
    </script>

    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Let Me Watch It | Alt.Ctrl Prototype</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,1,0" />
    
    <style>
        @font-face {
            font-family: "DungGeunMo";
            src: url("https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_six@1.2/DungGeunMo.woff") format("woff");
        }

        body {
            background-color: #0a0a0a;
            color: #e0e0e0;
            font-family: "DungGeunMo", monospace;
            user-select: none;
            overflow-x: hidden;
        }

        .crt-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            aspect-ratio: 4/3;
            margin: 0 auto;
            background: #1a1a1a;
            border-radius: 40px;
            padding: 20px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8), inset 0 0 20px rgba(255, 255, 255, 0.1);
            border: 10px solid #2a2a2a;
            transition: transform 0.05s;
            cursor: crosshair;
        }

        .screen-border {
            position: relative;
            width: 100%;
            height: 100%;
            background: #000;
            overflow: hidden;
            border-radius: 12%; 
            box-shadow: inset 0 0 80px rgba(0, 0, 0, 0.9);
        }

        .screen-content {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: center; align-items: center;
        }

        .scanlines {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            background-size: 100% 4px;
            z-index: 10; pointer-events: none;
        }

        .vignette {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, transparent 50%, rgba(0, 0, 0, 0.8) 120%);
            z-index: 11; pointer-events: none;
        }

        .squeeze { animation: squeezeAnim 0.8s cubic-bezier(0.75, 0, 0.25, 1) forwards; }
        @keyframes squeezeAnim {
            0% { transform: scale(1, 1); opacity: 1; }
            50% { transform: scale(1, 0.01); opacity: 1; filter: brightness(5); }
            100% { transform: scale(0, 0); opacity: 0; }
        }

        .flash { animation: flashAnim 0.1s ease-out; }
        @keyframes flashAnim {
            0% { filter: brightness(2) contrast(1.5); transform: translate(3px, 1px); }
            100% { filter: brightness(1); transform: translate(0, 0); }
        }

        .osd-volume {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0, 150, 0, 0.8);
            color: white; padding: 2px 10px; font-size: 18px;
            z-index: 20; display: none;
        }

        .volume-bar {
            height: 15px; background: #00ff00;
            display: inline-block; transition: width 0.1s steps(10);
        }

        .instruction-overlay {
            position: absolute; bottom: 20px; width: 100%;
            text-align: center; color: #00ff00;
            text-shadow: 0 0 10px #00ff00; z-index: 25; font-size: 18px;
        }

        .debug-panel {
            max-width: 800px; margin: 20px auto;
            background: #111; padding: 15px;
            border-radius: 10px; border: 1px solid #333;
        }

        #video-layer, #anomaly-layer {
            width: 100%; height: 100%; object-fit: cover;
        }

        #video-layer { filter: contrast(1.1); }
        #anomaly-layer {
            position: absolute; top: 0; left: 0;
            opacity: 0; mix-blend-mode: screen;
            pointer-events: none;
        }

        #noise-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: url("https://media.giphy.com/media/oEI9uWUqWMrBK/giphy.gif");
            opacity: 0.05; pointer-events: none; z-index: 15;
        }
    </style>
</head>
<body class="p-4 md:p-8 flex flex-col items-center">
    <div class="text-center mb-4">
        <h1 class="text-3xl md:text-4xl font-bold tracking-tighter mb-1 text-red-600 uppercase">Let Me Watch It</h1>
        <p class="text-gray-400 text-sm font-sans">물리 피드백 아케이드 | 하드웨어 상호작용 프로토타입</p>
    </div>

    <!-- 메인 TV 유닛 -->
    <div class="crt-container" id="tv-body">
        <div class="screen-border" id="screen-border">
            <div class="scanlines"></div>
            <div class="vignette"></div>
            <div id="noise-overlay"></div>

            <div class="osd-volume" id="volume-ui">
                VOL <div class="volume-bar" id="volume-bar" style="width: 100px"></div>
            </div>

            <div class="screen-content" id="screen-main">
                <img id="video-layer" src="./korean-lottery.jpg" alt="Lotto" />
                <img id="anomaly-layer" src="./ghost-hand.jpg" alt="Anomaly" />

                <div class="instruction-overlay" id="instruction-text">
                    [ SPACE를 눌러 부팅 ]
                </div>
            </div>
        </div>
    </div>

    <!-- 하단 패널 -->
    <div class="debug-panel w-full grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="col-span-1 border-r border-gray-800 pr-4">
            <h3 class="text-lg text-yellow-500 mb-2 font-bold">DEVICE INPUT</h3>
            <ul class="text-xs space-y-2 text-gray-300">
                <li><kbd class="bg-gray-700 px-2 rounded font-bold text-white">SPACE</kbd> <strong>물리적 타격</strong></li>
                <li><kbd class="bg-gray-700 px-2 rounded font-bold text-white">↓ 방향키</kbd> <strong>볼륨 연타</strong></li>
                <li><kbd class="bg-gray-700 px-2 rounded font-bold text-white">WHEEL</kbd> <strong>안테나 조율</strong></li>
            </ul>
        </div>
        <div class="col-span-2">
            <h3 class="text-lg text-blue-500 mb-1 font-bold">SYSTEM LOG</h3>
            <p class="text-xs text-gray-400 leading-relaxed">
                침식이 진행될수록 이미지의 불투명도가 증가합니다. <br />
                <strong>주파수:</strong> 휠을 천천히 돌려 화면이 가장 맑아지는 지점을 찾으세요.
            </p>
            <div class="mt-3 flex items-center gap-4">
                <button id="btn-audio-init" class="bg-red-900 hover:bg-red-700 text-white px-3 py-1 text-xs rounded transition border border-red-500">
                    음향 가동
                </button>
                <div id="game-status" class="text-red-500 animate-pulse text-xs font-bold uppercase tracking-widest">Signal Missing</div>
            </div>
        </div>
    </div>

    <script>
        /**
         * Let Me Watch It - Advanced Game Engine
         */
        const GameEngine = {
            state: {
                current: "START",
                mode: "TAP",
                progress: 50,      // 현재 위험도 (0-100)
                volume: 50,        // 볼륨 게이지 (0-100)
                antennaAngle: 0,   // 현재 각도
                targetAngle: 180,  // 목표 각도
                waveStartTime: 0,  // 웨이브 시작 시각 (조기 클리어 방지)
                timer: null,
                isAudioReady: false
            },

            audio: { noise: null, hitSynth: null, successSynth: null },

            dom: {
                tvBody: document.getElementById("tv-body"),
                screen: document.getElementById("screen-border"),
                video: document.getElementById("video-layer"),
                anomaly: document.getElementById("anomaly-layer"),
                instruction: document.getElementById("instruction-text"),
                status: document.getElementById("game-status"),
                volUI: document.getElementById("volume-ui"),
                volBar: document.getElementById("volume-bar"),
                audioBtn: document.getElementById("btn-audio-init")
            },

            init() {
                this.dom.audioBtn.addEventListener("click", () => this.initAudio());
                window.addEventListener("keydown", (e) => this.handleInput(e));
                this.dom.tvBody.addEventListener("wheel", (e) => this.handleWheel(e), { passive: false });
            },

            initAudio() {
                if (this.state.isAudioReady) return;
                Tone.start();
                this.audio.noise = new Tone.Noise("white").toDestination();
                this.audio.noise.volume.value = -30;
                this.audio.hitSynth = new Tone.NoiseSynth().toDestination();
                this.audio.hitSynth.volume.value = -12;
                this.audio.successSynth = new Tone.MembraneSynth().toDestination();
                this.state.isAudioReady = true;
                this.dom.audioBtn.innerText = "AUDIO ONLINE";
                this.dom.audioBtn.classList.replace("bg-red-900", "bg-green-900");
            },

            start() {
                this.state.current = "PLAYING";
                this.dom.instruction.innerText = "";
                this.dom.status.innerText = "SIGNAL DETECTED";
                this.nextWave();
            },

            nextWave() {
                this.state.progress = 60; 
                this.state.volume = 50;
                this.state.waveStartTime = Date.now();
                
                const modes = ["TAP", "VOLUME", "ANTENNA"];
                this.state.mode = modes[Math.floor(Math.random() * modes.length)];
                
                this.dom.volUI.style.display = "none";
                this.dom.anomaly.style.opacity = "0";
                this.dom.anomaly.style.filter = "none";
                this.dom.video.style.filter = "none";

                switch(this.state.mode) {
                    case "TAP":
                        this.dom.instruction.innerText = "침식 발생: 화면을 때리세요 [SPACE]";
                        this.dom.anomaly.src = "./ghost-face.jpg";
                        break;
                    case "VOLUME":
                        this.dom.instruction.innerText = "잡음 감지: 볼륨을 줄이세요 [↓]";
                        this.dom.volUI.style.display = "block";
                        this.dom.anomaly.src = "./noise-maker.jpg";
                        break;
                    case "ANTENNA":
                        let offset = 120 + Math.random() * 120;
                        this.state.targetAngle = (this.state.antennaAngle + offset) % 360;
                        this.dom.instruction.innerText = "주파수 이탈: 안테나를 조율하세요 [WHEEL]";
                        this.dom.anomaly.src = "./another-broadcast.jpg";
                        break;
                }
                
                if (this.state.timer) clearInterval(this.state.timer);
                this.state.timer = setInterval(() => this.update(), 50);
            },

            update() {
                if (this.state.current !== "PLAYING") return;

                let visualOpacity = 0;

                switch(this.state.mode) {
                    case "TAP":
                        this.state.progress += 0.8;
                        visualOpacity = (this.state.progress / 100);
                        this.dom.video.style.filter = `blur(${this.state.progress / 12}px) grayscale(${this.state.progress/150})`;
                        break;

                    case "VOLUME":
                        this.state.volume += 1.3;
                        this.dom.volBar.style.width = `${this.state.volume * 2}px`;
                        if (this.state.isAudioReady) this.audio.noise.volume.value = -30 + (this.state.volume / 2.2);
                        visualOpacity = (this.state.volume / 100);
                        this.dom.video.style.filter = `contrast(${1 + (this.state.volume/100)}) brightness(${1 - (this.state.volume/250)})`;
                        break;

                    case "ANTENNA":
                        let diff = Math.abs(this.state.antennaAngle - this.state.targetAngle);
                        if (diff > 180) diff = 360 - diff;
                        
                        // [개선] 판정 범위 완화 (90 -> 120) 및 비선형 곡선 조정
                        visualOpacity = Math.pow(Math.min(diff / 120, 1), 1.3);
                        
                        // [개선] 판정 임계값 완화 (0.15 -> 0.25) 및 회복 속도 상향
                        if (visualOpacity < 0.25) {
                            this.state.progress -= 5.0; 
                            this.dom.status.innerText = "LOCKING SIGNAL...";
                        } else {
                            // [개선] 실패 시 감점 속도 하향 (0.6 -> 0.3)
                            this.state.progress += 0.3;
                            this.dom.status.innerText = "SEARCHING...";
                        }
                        this.dom.video.style.filter = `contrast(${1.5 - visualOpacity}) brightness(${1.2 - visualOpacity/2})`;
                        break;
                }

                this.dom.anomaly.style.opacity = Math.max(0, Math.min(1, visualOpacity));

                if (Date.now() - this.state.waveStartTime > 1000) {
                    if (this.state.progress >= 100 || this.state.volume >= 100) {
                        this.gameOver();
                    } else if (this.state.progress <= 0 || (this.state.mode === "VOLUME" && this.state.volume <= 0)) {
                        this.waveSuccess();
                    }
                }
            },

            handleInput(e) {
                if (this.state.current === "START" && e.code === "Space") {
                    this.initAudio();
                    this.start();
                    return;
                }
                if (this.state.current !== "PLAYING") return;

                if (e.code === "Space" && this.state.mode === "TAP") {
                    this.state.progress -= 18; 
                    this.applyVisualJuice(1.4);
                }
                if (e.code === "ArrowDown" && this.state.mode === "VOLUME") {
                    this.state.volume -= 22; 
                    this.applyVisualJuice(0.8);
                }
            },

            handleWheel(e) {
                if (this.state.current === "PLAYING" && this.state.mode === "ANTENNA") {
                    e.preventDefault(); 
                    this.state.antennaAngle = (this.state.antennaAngle + e.deltaY * 0.22) % 360;
                    if (this.state.antennaAngle < 0) this.state.antennaAngle += 360;
                    this.applyVisualJuice(0.12);
                }
            },

            applyVisualJuice(intensity = 1) {
                this.dom.screen.classList.add("flash");
                setTimeout(() => this.dom.screen.classList.remove("flash"), 100);
                
                const shakeX = (Math.random() - 0.5) * 20 * intensity;
                const shakeY = (Math.random() - 0.5) * 20 * intensity;
                this.dom.tvBody.style.transform = `translate(${shakeX}px, ${shakeY}px)`;
                setTimeout(() => this.dom.tvBody.style.transform = "translate(0,0)", 50);
                
                if (this.state.isAudioReady && intensity > 0.5) {
                    this.audio.hitSynth.triggerAttackRelease("16n");
                }
            },

            waveSuccess() {
                clearInterval(this.state.timer);
                this.state.current = "SUCCESS_WAIT";
                
                this.dom.instruction.innerText = "채널 고정 완료";
                this.dom.status.innerText = "SIGNAL STABLE";
                this.dom.anomaly.style.opacity = "0";
                this.dom.video.style.filter = "none";
                
                if (this.state.isAudioReady) this.audio.successSynth.triggerAttackRelease("A3", "4n");
                
                setTimeout(() => {
                    this.state.current = "PLAYING";
                    this.nextWave();
                }, 1800);
            },

            gameOver() {
                this.state.current = "LOSE";
                clearInterval(this.state.timer);
                this.dom.screen.classList.add("squeeze");
                this.dom.instruction.innerText = "신호를 잃었습니다. 당신도 잃었습니다.";
                this.dom.status.innerText = "OUT OF SERVICE";
                
                if (this.state.isAudioReady) {
                    this.audio.noise.stop();
                    this.audio.hitSynth.triggerAttackRelease("1s");
                }
                setTimeout(() => location.reload(), 5000);
            }
        };

        window.onload = () => GameEngine.init();
    </script>
</body>

</html>
